describe 'Units', ->
  @units = {}
  # id, bedrooms, img, price, bathrooms, address 
  u1 = [1, 3, '', 3, 2, '']
  u2 = [2, 3, '', 1, 5, '']
  u3 = [3, 3, '', 2, 1, '']
  @server = {
    areaUnits: (id, callback)-> 
      callback({
        units:[u1,u2,u3]
        meta:  {
          address: 5
          bathrooms: 4
          bedrooms: 1
          id: 0
          imgDomain: "http://www.realtimerental.com/rrv10/rentalphotos/15/"
          imgUrl: 2
          price: 3
        }
      })
    }
 
  beforeEach module 'Results'
  
  beforeEach module ($provide)=>
    $provide.value 'server', @server
    return

  beforeEach(inject((Units)=>
    @units = Units
    return
  ))

  it 'loads units and sets up all needed values', =>
    @units.load(1)
    @units.pagination.numPerPage = 1
    @units.filters.orderBy = 'price'
    expect(@units.filters.ranges.price.edges).toEqual [1,3]
    expect(@units.filters.ranges.bathrooms.edges).toEqual [1,5]
    expect(@units.filters.ranges.bedrooms.edges).toEqual [3,3]

  it 'returns a filtered page of units', =>
    @units.load(1)
    @units.filters.ranges.price.current = [0,5]
    @units.pagination.numPerPage = 2
    @units.applyFilters()
    expect(@units.filters.inRangeIndexes.length).toEqual 3
    expect(@units.page(1).length).toEqual 2
    expect(@units.page(2).length).toEqual 1

  it 'returns total numOfPages', =>
    @units.load(1)
    expect(@units.pagination.numOfPages()).toEqual 1
    @units.pagination.numPerPage = 2
    expect(@units.pagination.numOfPages()).toEqual 2
    @units.pagination.numPerPage = 1
    expect(@units.pagination.numOfPages()).toEqual 3

  # it 'returns current page', =>
  #   @units.load(1)
  #   @units.pagination.numPerPage = 2
  #   @units.pagination.currentPage = 1
  #   expect(@units.currentPage().length).toEqual 2 

  it 'sorts an array', =>
    units = [[15001,0,"15001.0.TH.jpg",2,5,"1 main"],[15024,506887,"15024.0.TH.jpg",6,4,"1 main"],[15025,598336,"15025.0.TH.jpg",1,1,"1 main"],[15028,276040,"15028.0.TH.jpg",7,3,"1 main"],[15060,667188,"15060.0.TH.jpg",2,6,"1 main"],[15084,591504,"15084.0.TH.jpg",7,8,"1 main"]]#,[15085,72136,"15085.0.TH.jpg",5,2,"1 main"],[15086,508068,"15086.0.TH.jpg",7,5,"1 main"]]#,[15087,296811,"15087.0.TH.jpg",1,4,"1 main"],[15088,62452,"15088.0.TH.jpg",6,5,"1 main"],[15089,208039,"15089.0.TH.jpg",6,6,"1 main"],[15093,336852,"15093.0.TH.jpg",4,3,"1 main"],[15093,202986,"15093.0.TH.jpg",2,6,"1 main"],[15117,96203,"15117.0.TH.jpg",0,5,"1 main"],[15127,435190,"15127.0.TH.jpg",3,6,"1 main"],[15131,617347,"15131.0.TH.jpg",1,3,"1 main"],[15137,606135,"15137.0.TH.jpg",7,1,"1 main"],[15137,143699,"15137.0.TH.jpg",0,7,"1 main"],[15137,490187,"15137.0.TH.jpg",7,3,"1 main"],[15139,556156,"15139.0.TH.jpg",2,2,"1 main"],[15140,331521,"15140.0.TH.jpg",1,6,"1 main"],[15143,428226,"15143.0.TH.jpg",1,1,"1 main"],[15145,145295,"15145.0.TH.jpg",1,2,"1 main"],[15151,144868,"15151.0.TH.jpg",5,4,"1 main"],[15151,550680,"15151.0.TH.jpg",2,0,"1 main"],[15156,166384,"15156.0.TH.jpg",2,3,"1 main"],[15156,225329,"15156.0.TH.jpg",3,4,"1 main"],[15157,494214,"15157.0.TH.jpg",5,3,"1 main"],[15157,516697,"15157.0.TH.jpg",2,3,"1 main"],[15164,414794,"15164.0.TH.jpg",4,8,"1 main"],[15169,220948,"15169.0.TH.jpg",3,6,"1 main"],[15187,401766,"15187.0.TH.jpg",2,5,"1 main"],[15189,312079,"15189.0.TH.jpg",2,1,"1 main"],[15191,689506,"15191.0.TH.jpg",4,7,"1 main"],[15199,168577,"15199.0.TH.jpg",7,6,"1 main"],[15199,333998,"15199.0.TH.jpg",6,7,"1 main"],[15201,318701,"15201.0.TH.jpg",1,3,"1 main"],[15201,406223,"15201.0.TH.jpg",1,5,"1 main"],[15216,303578,"15216.0.TH.jpg",1,8,"1 main"],[15220,589172,"15220.0.TH.jpg",5,5,"1 main"],[15231,586205,"15231.0.TH.jpg",0,8,"1 main"],[15235,162780,"15235.0.TH.jpg",1,8,"1 main"],[15239,558485,"15239.0.TH.jpg",6,5,"1 main"],[15254,466720,"15254.0.TH.jpg",4,1,"1 main"],[15256,670101,"15256.0.TH.jpg",0,4,"1 main"],[15259,172417,"15259.0.TH.jpg",5,8,"1 main"],[15263,492750,"15263.0.TH.jpg",4,8,"1 main"],[15266,91887,"15266.0.TH.jpg",5,3,"1 main"],[15270,668607,"15270.0.TH.jpg",1,0,"1 main"],[15273,483203,"15273.0.TH.jpg",3,5,"1 main"],[15274,515925,"15274.0.TH.jpg",7,0,"1 main"],[15279,81260,"15279.0.TH.jpg",3,3,"1 main"],[15281,418499,"15281.0.TH.jpg",7,7,"1 main"],[15286,573609,"15286.0.TH.jpg",7,8,"1 main"],[15287,66938,"15287.0.TH.jpg",1,0,"1 main"],[15292,115677,"15292.0.TH.jpg",0,6,"1 main"],[15303,194973,"15303.0.TH.jpg",2,8,"1 main"],[15306,611536,"15306.0.TH.jpg",0,7,"1 main"],[15308,659040,"15308.0.TH.jpg",1,2,"1 main"],[15316,608642,"15316.0.TH.jpg",0,0,"1 main"],[15316,512327,"15316.0.TH.jpg",2,7,"1 main"],[15318,356059,"15318.0.TH.jpg",4,5,"1 main"],[15319,218403,"15319.0.TH.jpg",5,8,"1 main"],[15324,121764,"15324.0.TH.jpg",4,0,"1 main"],[15326,621211,"15326.0.TH.jpg",4,4,"1 main"],[15327,169756,"15327.0.TH.jpg",3,0,"1 main"],[15329,629836,"15329.0.TH.jpg",3,8,"1 main"],[15329,179691,"15329.0.TH.jpg",4,0,"1 main"],[15330,674398,"15330.0.TH.jpg",2,4,"1 main"],[15332,233278,"15332.0.TH.jpg",3,5,"1 main"],[15332,166843,"15332.0.TH.jpg",3,6,"1 main"],[15335,407659,"15335.0.TH.jpg",6,1,"1 main"],[15336,459928,"15336.0.TH.jpg",3,8,"1 main"],[15337,390787,"15337.0.TH.jpg",6,3,"1 main"],[15338,399566,"15338.0.TH.jpg",1,3,"1 main"],[15345,67255,"15345.0.TH.jpg",1,6,"1 main"],[15346,537221,"15346.0.TH.jpg",6,1,"1 main"],[15346,106924,"15346.0.TH.jpg",7,3,"1 main"],[15347,516406,"15347.0.TH.jpg",3,7,"1 main"],[15353,674511,"15353.0.TH.jpg",3,1,"1 main"],[15356,279262,"15356.0.TH.jpg",5,6,"1 main"],[15356,172763,"15356.0.TH.jpg",4,5,"1 main"],[15362,269199,"15362.0.TH.jpg",6,1,"1 main"],[15364,76113,"15364.0.TH.jpg",6,5,"1 main"],[15365,69582,"15365.0.TH.jpg",7,8,"1 main"],[15365,63987,"15365.0.TH.jpg",5,8,"1 main"],[15369,312278,"15369.0.TH.jpg",1,2,"1 main"],[15369,106082,"15369.0.TH.jpg",3,8,"1 main"],[15373,250764,"15373.0.TH.jpg",2,1,"1 main"],[15373,448604,"15373.0.TH.jpg",0,4,"1 main"],[15374,507645,"15374.0.TH.jpg",0,3,"1 main"],[15374,639985,"15374.0.TH.jpg",6,7,"1 main"],[15377,225845,"15377.0.TH.jpg",5,7,"1 main"],[15379,588620,"15379.0.TH.jpg",7,6,"1 main"],[15381,115863,"15381.0.TH.jpg",1,6,"1 main"],[15382,608248,"15382.0.TH.jpg",7,6,"1 main"],[15383,418158,"15383.0.TH.jpg",6,2,"1 main"],[15385,478642,"15385.0.TH.jpg",3,0,"1 main"],[15385,261636,"15385.0.TH.jpg",3,6,"1 main"],[15388,114967,"15388.0.TH.jpg",1,0,"1 main"],[15388,195578,"15388.0.TH.jpg",1,7,"1 main"],[15404,83978,"15404.0.TH.jpg",5,8,"1 main"],[15407,255363,"15407.0.TH.jpg",2,2,"1 main"],[15408,498404,"15408.0.TH.jpg",2,8,"1 main"],[15411,657822,"15411.0.TH.jpg",0,4,"1 main"],[15412,170143,"15412.0.TH.jpg",2,1,"1 main"],[15413,516866,"15413.0.TH.jpg",3,8,"1 main"],[15413,375364,"15413.0.TH.jpg",6,1,"1 main"],[15414,399032,"15414.0.TH.jpg",2,4,"1 main"],[15415,589402,"15415.0.TH.jpg",5,4,"1 main"],[15418,358682,"15418.0.TH.jpg",7,8,"1 main"],[15420,251967,"15420.0.TH.jpg",2,0,"1 main"],[15422,298924,"15422.0.TH.jpg",0,0,"1 main"],[15423,313617,"15423.0.TH.jpg",1,2,"1 main"],[15425,464331,"15425.0.TH.jpg",1,5,"1 main"],[15427,312234,"15427.0.TH.jpg",5,2,"1 main"],[15427,592750,"15427.0.TH.jpg",4,7,"1 main"],[15433,695126,"15433.0.TH.jpg",2,5,"1 main"],[15433,614552,"15433.0.TH.jpg",6,5,"1 main"],[15434,186011,"15434.0.TH.jpg",1,0,"1 main"],[15437,498274,"15437.0.TH.jpg",7,3,"1 main"],[15438,690091,"15438.0.TH.jpg",3,6,"1 main"],[15440,390571,"15440.0.TH.jpg",0,0,"1 main"],[15441,332850,"15441.0.TH.jpg",2,6,"1 main"],[15444,556664,"15444.0.TH.jpg",7,7,"1 main"],[15447,405148,"15447.0.TH.jpg",7,6,"1 main"],[15450,253857,"15450.0.TH.jpg",4,1,"1 main"],[15453,137393,"15453.0.TH.jpg",7,5,"1 main"],[15456,691905,"15456.0.TH.jpg",6,8,"1 main"],[15458,216578,"15458.0.TH.jpg",4,8,"1 main"],[15460,289905,"15460.0.TH.jpg",3,5,"1 main"],[15464,607594,"15464.0.TH.jpg",6,5,"1 main"],[15468,379534,"15468.0.TH.jpg",4,0,"1 main"],[15470,554788,"15470.0.TH.jpg",1,0,"1 main"],[15472,255446,"15472.0.TH.jpg",2,2,"1 main"],[15473,357827,"15473.0.TH.jpg",0,1,"1 main"],[15475,153962,"15475.0.TH.jpg",0,8,"1 main"],[15475,448948,"15475.0.TH.jpg",4,7,"1 main"],[15486,679596,"15486.0.TH.jpg",2,4,"1 main"],[15487,86660,"15487.0.TH.jpg",3,4,"1 main"],[15509,483551,"15509.0.TH.jpg",4,2,"1 main"],[15510,448139,"15510.0.TH.jpg",4,8,"1 main"],[15516,543965,"15516.0.TH.jpg",6,8,"1 main"],[15523,289660,"15523.0.TH.jpg",2,0,"1 main"],[15532,663170,"15532.0.TH.jpg",2,7,"1 main"],[15539,639262,"15539.0.TH.jpg",6,4,"1 main"],[15541,409549,"15541.0.TH.jpg",7,2,"1 main"],[15541,257965,"15541.0.TH.jpg",4,4,"1 main"],[15557,335843,"15557.0.TH.jpg",4,6,"1 main"],[15560,79204,"15560.0.TH.jpg",7,3,"1 main"],[15565,597663,"15565.0.TH.jpg",7,3,"1 main"],[15568,175972,"15568.0.TH.jpg",0,2,"1 main"],[15573,442620,"15573.0.TH.jpg",1,0,"1 main"],[15574,524643,"15574.0.TH.jpg",3,8,"1 main"],[15580,469773,"15580.0.TH.jpg",7,4,"1 main"],[15582,612989,"15582.0.TH.jpg",6,7,"1 main"],[15591,402499,"15591.0.TH.jpg",7,5,"1 main"],[15616,311773,"15616.0.TH.jpg",4,3,"1 main"],[15618,312589,"15618.0.TH.jpg",7,4,"1 main"],[15619,356579,"15619.0.TH.jpg",0,4,"1 main"],[15629,585896,"15629.0.TH.jpg",5,8,"1 main"],[15632,282372,"15632.0.TH.jpg",1,5,"1 main"],[15632,424248,"15632.0.TH.jpg",3,5,"1 main"],[15635,318128,"15635.0.TH.jpg",1,1,"1 main"],[15639,662483,"15639.0.TH.jpg",2,5,"1 main"],[15639,602627,"15639.0.TH.jpg",6,1,"1 main"],[15643,532910,"15643.0.TH.jpg",1,2,"1 main"],[15660,167841,"15660.0.TH.jpg",6,8,"1 main"],[15668,635889,"15668.0.TH.jpg",3,5,"1 main"],[15668,636739,"15668.0.TH.jpg",4,3,"1 main"],[15671,367841,"15671.0.TH.jpg",2,6,"1 main"],[15683,407662,"15683.0.TH.jpg",0,0,"1 main"],[15684,365075,"15684.0.TH.jpg",3,1,"1 main"],[15688,643328,"15688.0.TH.jpg",3,0,"1 main"],[15758,591025,"15758.0.TH.jpg",5,3,"1 main"],[15775,346703,"15775.0.TH.jpg",0,5,"1 main"],[15818,115100,"15818.0.TH.jpg",7,4,"1 main"],[15837,187784,"15837.0.TH.jpg",6,3,"1 main"],[15855,439837,"15855.0.TH.jpg",5,0,"1 main"],[15873,247480,"15873.0.TH.jpg",0,8,"1 main"],[15873,624511,"15873.0.TH.jpg",2,0,"1 main"],[15914,205911,"15914.0.TH.jpg",6,3,"1 main"],[15929,618548,"15929.0.TH.jpg",3,7,"1 main"],[15943,572425,"15943.0.TH.jpg",1,7,"1 main"],[15943,602428,"15943.0.TH.jpg",4,0,"1 main"],[15966,277529,"15966.0.TH.jpg",7,7,"1 main"],[15969,369721,"15969.0.TH.jpg",3,1,"1 main"],[15976,180468,"15976.0.TH.jpg",2,6,"1 main"],[15977,557076,"15977.0.TH.jpg",4,4,"1 main"]]
    #units = [[2,3], [1,8], [3,6],[4,4],[9,2],[32,3]]
    expect(@units.mergeSort(units, 1)[0]).toEqual [15001,0,"15001.0.TH.jpg",2,5,"1 main"]
